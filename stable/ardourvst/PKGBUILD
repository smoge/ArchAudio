# Maintainer: Arch Linux Pro Audio <dev@archaudio.org>
# Contributor: Ray Rashif <schivmeister@gmail.com>
# Contributor: tobias <tobias@archlinux.org>

# ardour, liblrdf and raptor are heavily dependent on each other. Updating of
# one package mostly will require an update of all the other packages. I vote
# for fixed dependencies speaking in terms of versions

pkgname=ardourvst
_pkgname=ardour
pkgver=2.8.4
pkgrel=1
pkgdesc="Ardour with win32 VST support"
arch=(i686)
license=('GPL')
url="http://ardour.org/"
depends=('liblrdf>=0.4.0' 'liblrdf<0.4.1'
         'libgnomecanvasmm' 'liblo' 'libusb' 'aubio' 'flac'
         'slv2' 'rubberband' 'wine')
optdepends=('cwiid: Wiimote support')
makedepends=('subversion' 'ladspa' 'scons' 'boost' 'cwiid')
install=$pkgname.install
source=($pkgname.desktop
	execfix.patch)

build() {
  cd "$srcdir"

  warning "Downloading from VCS as upstream has no direct-download..."
  if [ ! -d $_pkgname-svn ]; then
    svn co http://subversion.ardour.org/svn/ardour2/tags/$pkgver $_pkgname-svn
  fi
  rm -rf $_pkgname-$pkgver
  cp -a $_pkgname-svn $_pkgname-$pkgver
  msg "Download complete or server timeout"
  msg "Starting build process..."

  # start building ardour now
  cd $_pkgname-$pkgver

  # fix error on startup
  patch -Np0 -i ../execfix.patch || return 1

  sed -i '/-O3/d' SConstruct

  scons $MAKEFLAGS ARCH="$CFLAGS" \
        PREFIX="/usr" \
	FREESOUND=1 \
	WIIMOTE=1 \
	VST=1 \
        DESTDIR="$pkgdir" || return 1

  scons PREFIX="/usr" \
	FREESOUND=1 \
	WIIMOTE=1 \
	VST=1 \
        DESTDIR="$pkgdir" install

  # freedesktop.org compatibility
  install -Dm644 "$srcdir/$pkgname.desktop" \
    "$pkgdir/usr/share/applications/$pkgname.desktop"
}
md5sums=('eff9c690ec52ab55131d089f23c71d39'
         'f825fd2ddeccff2c953cbe7719d86247')

# $Id$
# Maintainer: Arch Linux Pro Audio <dev@archaudio.org>
# Contributor: Jon Austin (IRC: slypheed) <jon.i.austin (gmail)>
# Contributor: Bernardo 'smoge' Barros <bernardobarros@gmail.com>

pkgname=csound-git
pkgver=20110507
pkgrel=1
pkgdesc="A programming language designed and optimized for sound rendering and signal processing"
url="http://csound.sourceforge.net/"
arch=('i686' 'x86_64')
license=('LGPL' 'GPL')
depends=('python2' 'fltk' 'portaudio' 'jdk')
makedepends=('scons' 'swig' 'git')
provides=('csound5' 'csound')
conflicts=('csound' 'csound5' 'csound5-cvs')
install=${pkgname}.install

_gitroot="git://csound.git.sourceforge.net/gitroot/csound/csound5"
_gitname="csound"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot $_gitname
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_gitname-build"
  cp -r "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  scons customCFLAGS="-O2 -march=native -mtune=native" usePortMIDI=0 usePortAudio=1 custom=custom-linux-mkg.py buildLuaWrapper=1 buildPythonWrapper=1 useJack=1 buildvst4cs=0 buildInterfaces=0 buildCsoundAC= buildJavaWrapper=0 useOSC=1 buildPythonOpcodes=1 buildLoris=0 buildStkOpcodes=0 noFLTKThreads=0 useLrint=0 
  
  python2 install.py --prefix=$pkgdir
}

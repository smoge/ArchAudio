# $Id$
# Maintainer: Arch Linux Pro Audio <dev@archaudio.org>
# Contributor: Jon Austin (IRC: slypheed) <jon.i.austin (gmail)>
# Contributor: Bernardo Barros <bernardobarros@gmail.com>

pkgname=csound-git
pkgver=20110416
pkgrel=1
pkgdesc="A programming language designed and optimized for sound rendering and signal processing"
url="http://csound.sourceforge.net/"
arch=('i686' 'x86_64')
license=('LGPL' 'GPL')
depends=('python2' 'fltk' 'portaudio' 'jdk')
makedepends=('scons' 'swig' 'git')
provides=('csound5' 'csound')
conflicts=('csound' 'csound5-cvs')
install=${pkgname}.install

case $CARCH in
  'i686')
    _gccOptions="-O2 -march=i686 -mtune=generic -pipe" ;;
  'x86_64')
    _gccOptions="-O2 -march=x86-64 -mtune=generic -pipe" ;;
esac

_gitroot="git://csound.git.sourceforge.net/gitroot/csound/csound5"
_gitname="csound"

# useDouble is a requirement for using with blue via csound api:

_csOptions="usePortAudio=1 usePortMIDI=0 buildCsound5GUI=1 useOSC=1 buildPythonOpcodes=1 buildInterfaces=1 buildVirtual=1 dynamicCsoundLibrary=1 buildJavaWrapper=1 useDouble=1"


build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot $_gitname
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  scons customCFLAGS="$_gccOptions" $_csOptions
  python2 install.py --prefix=$pkgdir

}

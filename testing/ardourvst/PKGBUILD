# Contributor: Ray Rashif <schivmeister@gmail.com>
# Contributor: tobias <tobias@archlinux.org>

# ardour, liblrdf and raptor are heavily dependent on each other. Updating of
# one package mostly will require an update of all the other packages. I vote
# for fixed dependencies speaking in terms of versions

pkgname=ardourvst
_pkgname=ardour
pkgver=2.8
pkgrel=1
pkgdesc="Digital Audio Workstation with Windows VST Support"
arch=(i686)
license=('GPL')
url="http://ardour.org"
depends=('liblrdf>=0.4.0-5' 'libsamplerate' 'jack-audio-connection-kit' 'flac'
         'curl>=7.16.2' 'libart-lgpl' 'ladspa' 'libxslt' 'libgnomecanvas'
         'liblo' 'libusb' 'fftw' 'aubio' 'wine')
makedepends=('librsvg' 'scons' 'boost')
provides=('ardour')
conflicts=('ardour' 'ardour-vstlv2')
install=${pkgname}.install
source=(http://ardour.org/files/releases/${_pkgname}-${pkgver}.tar.bz2 \
        ${pkgname}.desktop)

build() {
  # start building ardour now
  cd ${startdir}/src/${_pkgname}-${pkgver}
  sed -i -e "s@/configure@& --prefix=/usr@g" libs/libsndfile/SConscript
  sed -i -e "s/lib64/lib/g" SConstruct
  #sed -i "s/_protocol.h>/\0\n#include <cstring>/g" libs/surfaces/tranzport/screen.cc

  # force -O2 from the CFLAGS in makepkg.conf
  sed -i '/-O3/d' SConstruct
  scons ARCH="${CFLAGS}" \
        PREFIX="/usr" \
        DESTDIR="${startdir}/pkg" \
	VST=1 || return 1
  scons PREFIX="/usr" \
        DESTDIR="${startdir}/pkg" \
	VST=1 \
        install || return 1
   # install some freedesktop.org compatibility
  install -D -m644 ${startdir}/src/${pkgname}.desktop \
    ${startdir}/pkg/usr/share/applications/${pkgname}.desktop
}
md5sums=('24bd768dbe08f1f2724dc97704ee0518'
         'ddce95745d31c87f8294a05f9dd923bf')

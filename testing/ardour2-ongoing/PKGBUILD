# $Id$
# Maintainer: Arch Linux Pro Audio <dev@archaudio.org>
# Contributor: Bernardo Barros <bernardobarros@gmail.com>

pkgname=ardour2-ongoing
_realname=ardour2-ongoing
pkgver=svn
pkgrel=1
pkgdesc="Professional-grade Digital Audio Workstation"
arch=('i686' 'x86_64')
license=('GPL')
url="http://ardour.org/"
depends=('liblrdf>=0.4.0' 'liblrdf<0.4.1'
         'libgnomecanvasmm' 'liblo' 'libusb' 'aubio' 'flac'
         'slv2' 'rubberband')
optdepends=('cwiid: Wiimote support')
makedepends=('subversion' 'ladspa' 'scons' 'boost' 'cwiid')
install=$pkgname.install
source=($pkgname.desktop)
md5sums=('a2cbe522d7fb44fd99edc62a584a0561')

_svntrunk=http://subversion.ardour.org/svn/ardour2/branches/2.0-ongoing
_svnmod=${_realname}

build() {

  cd ${srcdir}

  rm -rf "${_svnmod}-build"

  if [ -d $_svnmod ] ; then
    (cd $_svnmod && svn update)
    msg "The local files are updated."
  else
    svn co ${_svntrunk} ${_svnmod}
  fi

  msg "Download complete or server timeout"
  msg "Starting build process..."

  cp -rf ${_svnmod} ${_svnmod}-build
  cd ${_svnmod}-build

  sed -i '/-O3/d' SConstruct

  scons $MAKEFLAGS ARCH="$CFLAGS" PREFIX="/usr" FREESOUND=1 WIIMOTE=1 LIBLO=1 LV2=1 PROGRAM_NAME="Ardour2" AUBIO=1 NLS=1 SURFACES=1 DESTDIR="$pkgdir"
  scons PREFIX="/usr" FREESOUND=1 WIIMOTE=1 DESTDIR="$pkgdir" install

  # freedesktop.org compatibility
  install -Dm644 "${_svnmod}-build/$pkgname.desktop" "$pkgdir/usr/share/applications/$pkgname.desktop"

}
